{% extends 'layouts/main.html' %}

{% load staticfiles %}

{% block title %}
  User Profile
{% endblock title %}

{% block main_css %}
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css">
{% endblock main_css %}

{% block content %}

<section class="content-region profile-page">
  <div class="container-fluid">
  <h1>My Account</h1>
  <form class="profile" onsubmit="return validateProfile()" action="{% url 'main.views.edit_profile_info' %}" id="edit_profile" method="POST">
    {% csrf_token %}
    <div class="std-sub-title">Personal Info</div>
    <div class="profile-row">
     <div class="pull-right text-right profile-img">
        {% if user.profile.profile_photo_url %}
            <img src="{{user.profile.profile_photo_url}}">
        {% else %}
            <img src="{% static 'images/default_user.png' %}">
        {% endif %}
      </div>
      <div class="profile-section">
        <label>Name</label>
        <input type="text" class="form-control non-edit allow-edit" name='user_full_name' id='user_full_name' value="{{ user.get_full_name }}" disabled>
         <label>Email </label>
        <input type="text" class="form-control non-edit" name='user_email' value="{{ user.email }}" disabled>
         <label>Phone</label>
        <input type="text" class="form-control non-edit allow-edit" name="user_phone" id="user_phone" value="{{ user.profile.phone }}" disabled>
      </div>     
    </div>
    <div class="std-sub-title">Team Info</div>
    <div class="profile-row">
      <div class="profile-section editable">
        {% if 'google' in request.user.email %}
          <label>Team</label>
           <select class="form-control non-edit allow-edit" disabled name="user_team" id="user_team">
              <option value="0">Select Team</option>
              {% for team in teams %}
              <option value="{{team.id}}">{{team.team_name}}</option>
              {% endfor %}
          </select>
        {% endif %}
        
         <label>Manager Email</label>
        <input type="text" class="form-control non-edit allow-edit" name="user_manager_email" id="user_manager_email" {% if user.profile.user_manager_email %}value="{{ user.profile.user_manager_email }}"{% endif %} disabled>

        <label>Manager Name </label>
        <input type="text" class="form-control non-edit allow-edit" name="user_manager_name" id="user_manager_name" {% if user.profile.user_manager_name %} value="{{ user.profile.user_manager_name }}"{% endif %}>

        {% if 'google' in request.user.email %}

    <!-- <input type="text" class="form-control non-edit allow-edit" name="user_team" id="user_team" {% if user.profile.team %} value="{{ user.profile.team }}"{% endif %} disabled> -->
        

          <label>Market Served</label>
          <select class="form-control non-edit allow-edit" name="user_location" id="user_location" disabled>
              <option value="0">Market Served</option>
              {% for loc in locations %}
              <option value="{{loc.id}}">{{loc.location_name}}</option>
              {% endfor %}
          </select>
        {% endif %}
      </div>
      </div>      
    <div class="btns text-center">
        <div class="btn-group">
            <button class="btn std-btn" id="profileEdit">Edit</button>
            <button class="btn std-btn" style="display:none" id="profileUpdate">Update</button>
            <button class="btn std-btn grayed" style="display:none" id="profileCancel">Cancel</button>
        </div>
    </div>
  </form>
  </div>
</section>
{% endblock content %}

{% block main_js %}
    <script src="{% static 'js/jquery-ui.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/profile.js' %}"></script>
     <script type="text/javascript">
      window.user_full_name = "{{user.get_full_name|safe}}"
      window.loc_id = {{user.profile.location.id|safe}}
      window.team_id = {{user.profile.team.id|safe}}
      window.manager_name = "{{user.profile.user_manager_name|safe}}"
      window.manager_email = "{{user.profile.user_manager_email|safe}}"
      window.phone = "{{user.profile.phone|safe}}"
      window.manager_details = {{manager_details|safe}}


      $("#user_manager_email").autocomplete({
      source: {{managers|safe}},
      select: function(event,ui){
         $("#user_manager_email").val(ui.item.value);
         $('#user_manager_name').val(window.manager_details[ui.item.value]);
      }
    });
    </script>
{% endblock main_js %}