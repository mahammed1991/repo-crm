{% extends 'layouts/main.html' %}

{% load staticfiles %}

{% block content %}

<section class="content-region profile-page">
  <div class="container-fluid">
  <h1>My Account</h1>
  <form class="profile" onsubmit="return validateProfile()" action="{% url 'main.views.edit_profile_info' %}" id="edit_profile" method="POST">
    {% csrf_token %}
    <div class="std-sub-title">Personal Info</div>
    <div class="profile-row">
     <div class="pull-right text-right profile-img">
        {% if user.profile.profile_photo_url %}
            <img src="{{user.profile.profile_photo_url}}">
        {% else %}
            <img src="{% static 'images/default_user.png' %}">
        {% endif %}
      </div>
      <div class="profile-section">
        <label>Name</label>
        <input type="text" class="form-control non-edit" name='user_full_name' value="{{ user.get_full_name }}" disabled>
         <label>Email </label>
        <input type="text" class="form-control non-edit" name='user_email' value="{{ user.email }}" disabled>
         <label>Phone</label>
        <input type="text" class="form-control non-edit" name="user_phone" value="{{ user.profile.phone }}" disabled>
      </div>     
    </div>
    <div class="std-sub-title">Team Info</div>
    <div class="profile-row">
      <div class="profile-section editable">
        <label>Team</label>
         <select class="form-control non-edit allow-edit" disabled name="user_team" id="user_team">
            <option value="">Select Team</option>
            {% for team in teams %}
            <option value="{{team.id}}">{{team.team_name}}</option>
            {% endfor %}
        </select>
        <!-- <input type="text" class="form-control non-edit allow-edit" name="user_team" id="user_team" {% if user.profile.team %} value="{{ user.profile.team }}"{% endif %} disabled> -->
         <label>Manager Name </label>
        <input type="text" class="form-control non-edit allow-edit" name="user_manager_name" id="user_manager_name" {% if user.profile.user_manager_name %}value="{{ user.profile.user_manager_name }}"{% endif %} disabled>
         <label>Manager Email</label>
        <input type="text" class="form-control non-edit allow-edit" name="user_manager_email" id="user_manager_email" {% if user.profile.user_manager_email %}value="{{ user.profile.user_manager_email }}"{% endif %} disabled>
        <label>Program Location</label>
        <select class="form-control non-edit allow-edit" name="user_location" id="user_location" disabled>
            <option value="">Select Location</option>
            {% for loc in locations %}
            <option value="{{loc.id}}">{{loc.location_name}}</option>
            {% endfor %}
        </select>
      </div>
      </div>      
    <div class="btns text-center">
        <div class="btn-group">
            <button class="btn std-btn" id="profileEdit">Edit</button>
            <button class="btn std-btn" style="display:none" id="profileUpdate">Update</button>
            <button class="btn std-btn grayed" style="display:none" id="profileCancel">Cancel</button>
        </div>
    </div>
  </form>
  </div>
</section>
{% endblock content %}

{% block main_js %}
    <script type="text/javascript">

        $(document).ready(function(){
            $("#user_location").val("{{user.profile.location.id}}");
            $("#user_team").val("{{user.profile.team.id}}");

            // Click on edit button on profile
            $("#profileEdit").click(function(){
                $(this).hide();
                $("#profileUpdate").show();
                $("#profileCancel").show();
                $(".allow-edit").removeClass('non-edit');
                $(".allow-edit").attr('disabled', false);
                return false;
            });

            // Click on cancel button on profile
            $("#profileCancel").click(function(){
                $(this).hide();
                $("#profileUpdate").hide();
                $("#profileEdit").show();
                $("#user_team").val("{{user.profile.team.id}}");
                $("#user_manager_name").val("{{user.profile.user_manager_name}}");
                $("#user_manager_email").val("{{user.profile.user_manager_email}}");
                $("#user_location").val("{{user.profile.location.id}}");
                $(".allow-edit").addClass('non-edit');
                $(".allow-edit").attr('disabled', true);
                return false;
            });
        });

        function validateProfile(){
            // Remove all error messages
            $(".error-txt").remove();

            // Team Validation
            team_elem = $("#user_team");
            if (team_elem.val() == "") {
               $(team_elem).addClass('error-box');
               $(team_elem).after('<span class="error-txt">Please choose Team name</span>');
               $(team_elem).focus();   
                return false;
            }

            // User Manager Name Validation
            name_elem = $("#user_manager_name");
            if (name_elem.val() == "") {
               $(name_elem).addClass('error-box');
               $(name_elem).after('<span class="error-txt">Please enter Google Manager name</span>');
               $(name_elem).focus();   
                return false;
            }

            // User Manager Email Validation
            email_elem = $("#user_manager_email");
            if (email_elem.val() == "") {
               $(email_elem).addClass('error-box');
               $(email_elem).after('<span class="error-txt">Please enter Google Manager Email ID</span>');
               $(email_elem).focus();   
                return false;
            }else{
                var error = true;
                if(email_elem.val().split('@')[1] == "regalix-inc.com") {
                    var error = false;
                }
                if(error){
                    if(email_elem.val().split('@')[1] == "google.com") {
                        var error = false;
                    }
                }

                if(error){
                    $(email_elem).addClass('error-box');
                    $(email_elem).after('<span class="error-txt">Please enter a valid regalix or google Email ID</span>');
                    $(email_elem).focus();
                    return false;
                }
            }

            // User Location Validation
            location_elem = $("#user_location");
            if (location_elem.val() == "") {
               $(location_elem).addClass('error-box');
               $(location_elem).after('<span class="error-txt">Please choose Location name</span>');
               $(location_elem).focus();   
                return false;
            }
            

        }
    </script>
{% endblock main_js %}