{% extends 'layouts/main.html' %}

{% load rep_filters %}
{% load staticfiles %}

{% block title %}
Total Appointments
{% endblock title %}

{% block main_css %}
  <link rel="stylesheet" href="{% static 'css/representative/plan_schedule.css' %}">
  <style>
 
    .new_row_display{
            width:100%;
            position:relative;
            margin-left:20px;
            margin-right:20px;
            margin-top:20px;
    }

        .new_row_display_total{
            width:100%;
            position:relative;
            margin-left:20px;
            margin-right:20px;
            margin-top:20px;
    }
    .common_td{
            position:relative;
            background:#f8f8f8;
    }
     
    .m_inner_div{
            background:#fff;
            padding-top:5px;
            padding-bottom:5px;
            margin-bottom:5px;
            border-bottom: 1px solid #ccc;
    }
    .arrow-down {
            width: 0; 
            height: 0; 
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            position: absolute;
            display: none;
            bottom: -47%;
            
            left: 0;
            right:0;
            width:5px;
            text-align:center;
            margin:auto;
        }
.common_td:hover .arrow-down{
display:block;

}
.vva {
    float: right;
    font-size: 15px;
}

.cubg4{position: relative;}
</style>
{% endblock main_css %}

{% block content %}
<!-- content-region -->
<section class="content-region inner-page">
    <div class="container-fluid">
      <h1>Total APPOINTMENTS</h1>
      {% if  daylight_marquee_msg %}
                      <div class="performer">
                            <div class="performer-info" style="text-align:center; margin-bottom:8px; color:red;">
                              <marquee>{{daylight_marquee_msg}}</marquee>
                            </div>
                        </div>
       {% endif %} 
     <!-- google rep info -->
        {% if error %}
        <div class="row std-sub-top">
            <div class="col-xs-12 title-text">
                <span>Opps you don't have permission to access the appointments slots!</span>
            </div>
        </div>
        {% else %}
        <form action="" method="post" onsubmit="return validateForm()">
         {% csrf_token %}
            <div class="row std-sub-top">
                <div class="col-xs-2 ">
                     <input type="hidden" name='prev_week_start_date' value="{{prev_week|date:'m-d-Y'}}" />
                        <input type="hidden" name="prevselectedProcessType" id="prevselectedProcessType">
                        <input type="hidden" name="prevselectedTeams" id="prevselectedTeams">
                    <button type="submit" value="prev week" id="prev_week" class="text-prev" style="border: 0;background-color: transparent;color:#2763c9;font-family: 'robotoblack';">Previous Week</button>
                </div>
        </form>                        
                <div class="col-xs-8  title-text">
                    <span>Time Zone: IST(UTC:5:30)</span>
                </div>
        <form action="" method="post" onsubmit="return validateForm()">
         {% csrf_token %}
                <div class="col-xs-2 ">
                     <input type="hidden" name='next_week_start_date' value="{{next_week|date:'m-d-Y'}}" />
                        <input type="hidden" name="nextselectedProcessType" id="nextselectedProcessType">
                        <input type="hidden" name="nextselectedTeams" id="nextselectedTeams">
                    <button type="submit" value="next week" id="next_week" class="text-next" style="border: 0;background-color: transparent; color:#2763c9;font-family: 'robotoblack';">Next Week</button>
                </div>
            </div>
        </form> 
        
            <form method="post" action="" class="form" onsubmit="return validateForm()">
                {% csrf_token %}
            <input type="hidden" name='schedule_week_start_date' value="{{schedule_date|date:'m-d-Y'}}" />
            <div class="row" style="margin-left: 5px;">
                <div class="col-md-2 box2">
                    <div id="processTypesDiv" class="btn-group drpDown" style="width: 130px;">
                        <button type="button" class="form-control bgicon" id="processTypeBtn" style="width: 215px;">Process Type</button>
                        <ul class="dropdown-menu process-ul" style="margin-top: -21px;width: 215px;">
                            {% for item in process_types %}
                                <li id="{{item}}">
                                    <a href="#" class="small"><input type="checkbox" class="hiddenCheckbox" /><span class='glyphicon glyphicon-ok tickMark'></span>&nbsp;{{item}}</a>
                                </li>
                            {%endfor%}
                        </ul>
                    </div>
                </div>
                <div class="col-md-2 box2" style="margin-left: 61px;">
                    <div id="teamsDiv" class="btn-group drpDown" style="width: 130px;">
                        <button type="button" class="form-control bgicon" id="teamTypeBtn" style="width: 328px;">Teams</button>
                        <ul class="dropdown-menu teams-ul" style="overflow: scroll;height:auto;max-height:300px;margin-top: -21px;width: 328px;">
                            <li idValue='000' id='selectAll' class='selectAll hideItems'>
                                    <a href="#" class="small"><input type="checkbox" class="hiddenCheckbox" /><span class='glyphicon glyphicon-ok tickMark'></span>&nbsp;Select All</a>
                            </li>
                            {% for team in default_teams %}
                                <li idValue='{{team.id}}' id='{{team.process_type}}_{{team.id}}' class='{{team.process_type}} hideItems'>
                                    <a href="#" class="small"><input type="checkbox" class="hiddenCheckbox" /><span class='glyphicon glyphicon-ok tickMark'></span>&nbsp;{{team}}</a>
                                </li>
                            {%endfor%}
                        </ul>
                    </div>
                </div>
                <div class="col-md-2 box2 bb hideItems">
                    <select id="selectedProcessType" name="selectedProcessType" multiple="multiple">                        
                    </select>
                    <select id="selectedTeams" name="selectedTeams" multiple="multiple">
                    </select>
                </div>
                
                <div class="col-md-3 bbc" style="margin-left: 168px;margin-top: -17px;">
                    <div class="checkbox web-access">
                        <span>
                            <svg width="10" height="10" style="margin-right:3%">
                            <rect x="2" y="2" width="5" height="5" style="fill:blue;stroke:#ccccff;stroke-width:5;fill-opacity:0.1;stroke-opacity:1">
                            </svg>Without Appointments
                        </span><br />
                        <span>
                            <svg width="10" height="10" style="margin-right:3%">
                            <rect x="2" y="2" width="5" height="5" style="fill:blue;stroke:#C7F4D3;stroke-width:5;fill-opacity:0.1;stroke-opacity:1">
                            </svg>Appointments Booked
                        </span><br />
                      <span>
                        <svg width="12" height="12" style="margin-right:3%">
                            <rect x="2" y="2" width="9" height="9" style="fill:white;stroke:#000;stroke-width:0.5;fill-opacity:0.1;stroke-opacity:1">
                        </svg>
                      Slots Available</span>

                    </div>
                </div>

                <div class="col-md-5 bbd" style="margin-left: -8px;  margin-top: -8px;">
                     <button class="btn std-btn" id="form_submit" >Submit</button>
                </div>     
            </div>
        </form>
        <form method="post" action="{% url 'representatives.views.total_appointments' plan_month plan_day plan_year %}">
            {% csrf_token %}
            <div>
                <table class="table table-bordered table-hover table-responsive" cellspacing="10" style="border-spacing:5px; border-collapse: inherit;">
                    <tr>
                        <!-- <th>Slots/Day</th> -->
                        <th style="border-top:none !important; border:none !important; width:8% !important;"></th>
                        <th class="custom-bg" ><table class="table cubg" ><tr><td class="cubg"> Mon</td></tr><tr><td class="cubg">{{dates|get_dict_val:'day1'|date:"M d, Y"}}</td></tr></table></th>
                        <th class="custom-bg" ><table class="table cubg" ><tr><td class="cubg"> Tue</td></tr><tr><td class="cubg"> {{dates|get_dict_val:'day2'|date:"M d, Y"}}</td></tr></table></th>
                        <th class="custom-bg" ><table class="table cubg" ><tr><td class="cubg"> Wed</td></tr><tr><td class="cubg"> {{dates|get_dict_val:'day3'|date:"M d, Y"}}</td></tr></table></th>
                        <th class="custom-bg" ><table class="table cubg" ><tr><td class="cubg"> Thu</td></tr><tr><td class="cubg"> {{dates|get_dict_val:'day4'|date:"M d, Y"}}</td></tr></table></th>
                        <th class="custom-bg" ><table class="table cubg" ><tr><td class="cubg"> Fri</td></tr><tr><td class="cubg"> {{dates|get_dict_val:'day5'|date:"M d, Y"}}</td></tr></table></th>
                        <th class="custom-bg" ><table class="table cubg" ><tr><td class="cubg"> Sat</td></tr><tr><td class="cubg"> {{dates|get_dict_val:'day6'|date:"M d, Y"}}</td></tr></table></th>
                    </tr>

                     <tr style="background-color: rgb(166, 166, 104);">
                        <td class="cubg2">Total Leads W/O Appointment </td>
                        {% for data in without_appointmnet_list %}
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="2">
                                    <tr>
                                        <td style="background-color:rgb(204, 204, 255)" class=" common_td">{{data.total}}</td>
                                        <td class="cubg4">NA</td>
                                    </tr>
                                </table>
                            </td>
                        {% endfor %}
                    </tr>
                  

                    <tr style="background-color: rgb(166, 166, 104);">
                        <td class="cubg2">Total Leads With Appointment</td>
                        {% for slot in total_slots %}
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="2">
                                    <tr>
                                        <td  class="cubg3 common_td" onclick="teamCount({{slot.team_counts}})">{{slot.booked}}<div class="arrow-down" style="display: block; border-bottom-width: 10px; border-bottom-style: solid; border-bottom-color: rgb(199, 244, 211);margin-bottom:-11px;"></div></td>

                                        <td class="cubg4">{{slot.available}}</td>
                                    </tr>
                                </table>
                            </td>
                        {% endfor %}

                    </tr>

                    <tr class='new_row_display_total' style="display:none;">
                    
                        <td class='display_count' colspan='100%' style='background:#ccffff;'><div class='col-xs-12' style='padding-bottom: 0px !important;padding-top:0px !important;width: 102%;'><i class="fa fa-times vva" id="click-close"></i>
                        <p id="text-adding"></p>
                    </div>
                    </tr>
                 





                   {% for i in 3|get_range_specific:'12' %}
                        <tr class="first_{{forloop.counter}}">
                            {% if forloop.first %}
                                <td class="cubg2">{{i|concatenate:':00'}} AM</td>
                            {% else %}
                            <td class="cubg2">{{i|concatenate:':00'}} AM</td>
                            {% endif %}
                            {% with 'input_' as input %}
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day1'|date:"d_m_Y_" as next_day %}
                                    {% with input|concatenate:next_day|concatenate:i|concatenate:'_0_cur' as key_subs %}
                                    {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                    <tr><td class="cubg3 common_td" onclick="mytooltip('.first_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}' class="css3 common_td" onclick="mytooltip('.first_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                    {% endwith %}
                                    {% endwith %}
                                    {% endwith %}
                                </table>
                            </td>
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day2'|date:"d_m_Y_" as next_day %}
                                    {% with input|concatenate:next_day|concatenate:i|concatenate:'_0_cur' as key_subs %}
                                    {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                    <tr><td class="cubg3 common_td" onclick="mytooltip('.first_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.first_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                    {% endwith %}
                                    {% endwith %}
                                    {% endwith %}
                                </table>
                            </td>
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day3'|date:"d_m_Y_" as next_day %}
                                    {% with input|concatenate:next_day|concatenate:i|concatenate:'_0_cur' as key_subs %}
                                    {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                    <tr><td  class="cubg3 common_td" onclick="mytooltip('.first_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.first_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                    {% endwith %}
                                    {% endwith %}
                                    {% endwith %}
                                </table>
                            </td>

                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day4'|date:"d_m_Y_" as next_day %}
                                    {% with input|concatenate:next_day|concatenate:i|concatenate:'_0_cur' as key_subs %}
                                    {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                    <tr><td  class="cubg3 common_td" onclick="mytooltip('.first_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.first_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                    {% endwith %}
                                    {% endwith %}
                                    {% endwith %}
                                </table>
                            </td>
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day5'|date:"d_m_Y_" as next_day %}
                                    {% with input|concatenate:next_day|concatenate:i|concatenate:'_0_cur' as key_subs %}
                                    {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                    <tr><td  class="cubg3 common_td" onclick="mytooltip('.first_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.first_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                    {% endwith %}
                                    {% endwith %}
                                    {% endwith %}
                                </table>
                            </td>

                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day6'|date:"d_m_Y_" as next_day %}
                                    {% with input|concatenate:next_day|concatenate:i|concatenate:'_0_cur' as key_subs %}
                                    {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                    <tr><td  class="cubg3 common_td" onclick="mytooltip('.first_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.first_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                    {% endwith %}
                                    {% endwith %}
                                    {% endwith %}
                                </table>
                            </td>
                            {% endwith %}
                        </tr>
                        <tr class="first1_{{forloop.counter}}">
                            {% if forloop.first %}
                                <td class="cubg2">{{i|concatenate:':30'}} AM</td>
                            {% else %}
                            <td class="cubg2">{{i|concatenate:':30'}} AM</td>
                            {% endif %}
                            {% with 'input_' as input %}
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day1'|date:"d_m_Y_" as next_day %}
                                    {% with input|concatenate:next_day|concatenate:i|concatenate:'_30_cur' as key_subs %}
                                    {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                    <tr><td  class="cubg3 common_td" onclick="mytooltip('.first1_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.first1_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                    {% endwith %}
                                    {% endwith %}
                                    {% endwith %}
                                </table>
                            </td>
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day2'|date:"d_m_Y_" as next_day %}
                                    {% with input|concatenate:next_day|concatenate:i|concatenate:'_30_cur' as key_subs %}
                                    {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                    <tr><td  class="cubg3 common_td" onclick="mytooltip('.first1_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.first1_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                    {% endwith %}
                                    {% endwith %}
                                    {% endwith %}
                                </table>
                            </td>
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day3'|date:"d_m_Y_" as next_day %}
                                    {% with input|concatenate:next_day|concatenate:i|concatenate:'_30_cur' as key_subs %}
                                    {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                    <tr><td  class="cubg3 common_td" onclick="mytooltip('.first1_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}' class="css3 common_td" onclick="mytooltip('.first1_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                    {% endwith %}
                                    {% endwith %}
                                    {% endwith %}
                                </table>
                            </td>

                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day4'|date:"d_m_Y_" as next_day %}
                                    {% with input|concatenate:next_day|concatenate:i|concatenate:'_30_cur' as key_subs %}
                                    {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                    <tr><td  class="cubg3 common_td" onclick="mytooltip('.first1_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.first1_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                    {% endwith %}
                                    {% endwith %}
                                    {% endwith %}
                                </table>
                            </td>
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day5'|date:"d_m_Y_" as next_day %}
                                    {% with input|concatenate:next_day|concatenate:i|concatenate:'_30_cur' as key_subs %}
                                    {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                    <tr><td  class="cubg3 common_td" onclick="mytooltip('.first1_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.first1_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                    {% endwith %}
                                    {% endwith %}
                                    {% endwith %}
                                </table>
                            </td>

                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day6'|date:"d_m_Y_" as next_day %}
                                    {% with input|concatenate:next_day|concatenate:i|concatenate:'_30_cur' as key_subs %}
                                    {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                    <tr><td  class="cubg3 common_td" onclick="mytooltip('.first1_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.first1_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                    {% endwith %}
                                    {% endwith %}
                                    {% endwith %}
                                </table>
                            </td>
                            {% endwith %}
                        </tr>
                    {% endfor %}

                    <!-- ################## PM #######################################-->
                    {% for i in 12|get_range %}
                    <tr class="second_{{forloop.counter}}">
                            {% if forloop.first %}
                                <td class="cubg2">{{i|add:12|concatenate:':00'}} PM</td>
                            {% else %}
                            <td class="cubg2">{{i|concatenate:':00'}} PM</td>
                            {% endif %}
                            {% with 'input_' as input %}
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day1'|date:"d_m_Y_" as next_day and i|add:12 as next_loop %}
                                        {% with input|concatenate:next_day|concatenate:next_loop|concatenate:'_0_cur' as key_subs %}
                                        {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                        <tr><td  class="cubg3 common_td" onclick="mytooltip('.second_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.second_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                        {% endwith %}
                                        {% endwith %}
                                        {% endwith %}

                                </table>
                            </td>
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day2'|date:"d_m_Y_" as next_day and i|add:12 as next_loop %}
                                        {% with input|concatenate:next_day|concatenate:next_loop|concatenate:'_0_cur' as key_subs %}
                                        {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                        <tr><td  class="cubg3 common_td" onclick="mytooltip('.second_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.second_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                        {% endwith %}
                                        {% endwith %}
                                        {% endwith %}

                                </table>
                            </td>
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day3'|date:"d_m_Y_" as next_day and i|add:12 as next_loop %}
                                        {% with input|concatenate:next_day|concatenate:next_loop|concatenate:'_0_cur' as key_subs %}
                                        {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                        <tr><td  class="cubg3 common_td" onclick="mytooltip('.second_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.second_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                        {% endwith %}
                                        {% endwith %}
                                        {% endwith %}

                                </table>
                            </td>

                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day4'|date:"d_m_Y_" as next_day and i|add:12 as next_loop %}
                                        {% with input|concatenate:next_day|concatenate:next_loop|concatenate:'_0_cur' as key_subs %}
                                        {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                        <tr><td  class="cubg3 common_td" onclick="mytooltip('.second_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.second_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                        {% endwith %}
                                        {% endwith %}
                                        {% endwith %}

                                </table>
                            </td>
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day5'|date:"d_m_Y_" as next_day and i|add:12 as next_loop %}
                                        {% with input|concatenate:next_day|concatenate:next_loop|concatenate:'_0_cur' as key_subs %}
                                        {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                        <tr><td  class="cubg3 common_td" onclick="mytooltip('.second_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.second_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                        {% endwith %}
                                        {% endwith %}
                                        {% endwith %}

                                </table>
                            </td>

                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day6'|date:"d_m_Y_" as next_day and i|add:12 as next_loop %}
                                        {% with input|concatenate:next_day|concatenate:next_loop|concatenate:'_0_cur' as key_subs %}
                                        {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                        <tr><td  class="cubg3 common_td" onclick="mytooltip('.second_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.second_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                        {% endwith %}
                                        {% endwith %}
                                        {% endwith %}

                                </table>
                            </td>
                            {% endwith %}
                        </tr>
                        <tr class="second1_{{forloop.counter}}">
                            {% if forloop.first %}
                                <td class="cubg2">{{i|add:12|concatenate:':30'}} PM</td>
                            {% else %}
                            <td class="cubg2">{{i|concatenate:':30'}} PM</td>
                            {% endif %}
                            {% with 'input_' as input %}
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day1'|date:"d_m_Y_" as next_day and i|add:12 as next_loop %}
                                        {% with input|concatenate:next_day|concatenate:next_loop|concatenate:'_30_cur' as key_subs %}
                                        {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                        <tr><td  class="cubg3 common_td" onclick="mytooltip('.second1_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.second1_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                        {% endwith %}
                                        {% endwith %}
                                        {% endwith %}

                                </table>
                            </td>
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day2'|date:"d_m_Y_" as next_day and i|add:12 as next_loop %}
                                        {% with input|concatenate:next_day|concatenate:next_loop|concatenate:'_30_cur' as key_subs %}
                                        {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                        <tr><td  class="cubg3 common_td" onclick="mytooltip('.second1_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.second1_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                        {% endwith %}
                                        {% endwith %}
                                        {% endwith %}

                                </table>
                            </td>
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day3'|date:"d_m_Y_" as next_day and i|add:12 as next_loop %}
                                        {% with input|concatenate:next_day|concatenate:next_loop|concatenate:'_30_cur' as key_subs %}
                                        {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                        <tr><td  class="cubg3 common_td" onclick="mytooltip('.second1_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.second1_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                        {% endwith %}
                                        {% endwith %}
                                        {% endwith %}

                                </table>
                            </td>

                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day4'|date:"d_m_Y_" as next_day and i|add:12 as next_loop %}
                                        {% with input|concatenate:next_day|concatenate:next_loop|concatenate:'_30_cur' as key_subs %}
                                        {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                        <tr><td  class="cubg3 common_td" onclick="mytooltip('.second1_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.second1_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                        {% endwith %}
                                        {% endwith %}
                                        {% endwith %}

                                </table>
                            </td>
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day5'|date:"d_m_Y_" as next_day and i|add:12 as next_loop %}
                                        {% with input|concatenate:next_day|concatenate:next_loop|concatenate:'_30_cur' as key_subs %}
                                        {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                        <tr><td  class="cubg3 common_td" onclick="mytooltip('.second1_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.second1_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                        {% endwith %}
                                        {% endwith %}
                                        {% endwith %}

                                </table>
                            </td>

                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day6'|date:"d_m_Y_" as next_day and i|add:12 as next_loop %}
                                        {% with input|concatenate:next_day|concatenate:next_loop|concatenate:'_30_cur' as key_subs %}
                                        {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                        <tr><td  class="cubg3 common_td" onclick="mytooltip('.second1_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.second1_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                        {% endwith %}
                                        {% endwith %}
                                        {% endwith %}

                                </table>
                            </td>
                            {% endwith %}
                        </tr>
                    {% endfor %}

                    <!-- End of next rows -->
                    {% for i in 0|get_range_specific:'8' %}
                       <tr class="third_{{forloop.counter}}">
                            {% if forloop.first %}
                                <td class="cubg2">{{i|concatenate:':00'}} AM</td>
                            {% else %}
                            <td class="cubg2">{{i|concatenate:':00'}} AM</td>
                            {% endif %}
                            {% with 'input_' as input %}
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day1'|date:"d_m_Y_" as next_day %}
                                    {% with input|concatenate:next_day|concatenate:i|concatenate:'_0_next' as key_subs %}
                                    {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                    <tr><td  class="cubg3 common_td" onclick="mytooltip('.third_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.third_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                    {% endwith %}
                                    {% endwith %}
                                    {% endwith %}
                                </table>
                            </td>
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day2'|date:"d_m_Y_" as next_day %}
                                    {% with input|concatenate:next_day|concatenate:i|concatenate:'_0_next' as key_subs %}
                                    {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                    <tr><td  class="cubg3 common_td" onclick="mytooltip('.third_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.third_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                    {% endwith %}
                                    {% endwith %}
                                    {% endwith %}
                                </table>
                            </td>
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day3'|date:"d_m_Y_" as next_day %}
                                    {% with input|concatenate:next_day|concatenate:i|concatenate:'_0_next' as key_subs %}
                                    {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                    <tr><td  class="cubg3 common_td" onclick="mytooltip('.third_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.third_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                    {% endwith %}
                                    {% endwith %}
                                    {% endwith %}
                                </table>
                            </td>

                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day4'|date:"d_m_Y_" as next_day %}
                                    {% with input|concatenate:next_day|concatenate:i|concatenate:'_0_next' as key_subs %}
                                    {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                    <tr><td  class="cubg3 common_td" onclick="mytooltip('.third_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.third_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                    {% endwith %}
                                    {% endwith %}
                                    {% endwith %}
                                </table>
                            </td>
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day5'|date:"d_m_Y_" as next_day %}
                                    {% with input|concatenate:next_day|concatenate:i|concatenate:'_0_next' as key_subs %}
                                    {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                    <tr><td  class="cubg3 common_td" onclick="mytooltip('.third_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.third_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                    {% endwith %}
                                    {% endwith %}
                                    {% endwith %}
                                </table>
                            </td>

                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day6'|date:"d_m_Y_" as next_day %}
                                    {% with input|concatenate:next_day|concatenate:i|concatenate:'_0_next' as key_subs %}
                                    {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                    <tr><td  class="cubg3 common_td" onclick="mytooltip('.third_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.third_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                    {% endwith %}
                                    {% endwith %}
                                    {% endwith %}
                                </table>
                            </td>
                            {% endwith %}
                        </tr>
                        <tr class="third1_{{forloop.counter}}">
                            {% if forloop.first %}
                                <td class="cubg2">{{i|concatenate:':30'}} AM</td>
                            {% else %}
                            <td class="cubg2">{{i|concatenate:':30'}} AM</td>
                            {% endif %}
                            {% with 'input_' as input %}
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day1'|date:"d_m_Y_" as next_day %}
                                    {% with input|concatenate:next_day|concatenate:i|concatenate:'_30_next' as key_subs %}
                                    {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                    <tr><td  class="cubg3 common_td" onclick="mytooltip('.third1_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.third1_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                    {% endwith %}
                                    {% endwith %}
                                    {% endwith %}
                                </table>
                            </td>
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day2'|date:"d_m_Y_" as next_day %}
                                    {% with input|concatenate:next_day|concatenate:i|concatenate:'_30_next' as key_subs %}
                                    {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                    <tr><td  class="cubg3 common_td" onclick="mytooltip('.third1_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.third1_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                    {% endwith %}
                                    {% endwith %}
                                    {% endwith %}
                                </table>
                            </td>
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day3'|date:"d_m_Y_" as next_day %}
                                    {% with input|concatenate:next_day|concatenate:i|concatenate:'_30_next' as key_subs %}
                                    {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                    <tr><td  class="cubg3 common_td" onclick="mytooltip('.third1_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.third1_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                    {% endwith %}
                                    {% endwith %}
                                    {% endwith %}
                                </table>
                            </td>

                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day4'|date:"d_m_Y_" as next_day %}
                                    {% with input|concatenate:next_day|concatenate:i|concatenate:'_30_next' as key_subs %}
                                    {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                    <tr><td  class="cubg3 common_td" onclick="mytooltip('.third1_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.third1_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                    {% endwith %}
                                    {% endwith %}
                                    {% endwith %}
                                </table>
                            </td>
                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day5'|date:"d_m_Y_" as next_day %}
                                    {% with input|concatenate:next_day|concatenate:i|concatenate:'_30_next' as key_subs %}
                                    {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                    <tr><td  class="cubg3 common_td" onclick="mytooltip('.third1_{{forloop.counter}}', {{team_booked|safe}});"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.third1_{{forloop.counter}}', {{team_count|safe}});" /><div class="arrow-down"></div></td></tr>
                                    {% endwith %}
                                    {% endwith %}
                                    {% endwith %}
                                </table>
                            </td>

                            <td class="cubg2">
                                <table class="table ttb" cellspacing="0" cellpadding="0">
                                    {% with dates|get_dict_val:'day6'|date:"d_m_Y_" as next_day %}
                                    {% with input|concatenate:next_day|concatenate:i|concatenate:'_30_next' as key_subs %}
                                    {% with appointments|get_dict_val:key_subs|get_dict_val:'booked' as booked_count and appointments|get_dict_val:key_subs|get_dict_val:'value' as av_count and appointments|get_dict_val:key_subs|get_dict_val:'team_count' as team_count and appointments|get_dict_val:key_subs|get_dict_val:'team_booked' as team_booked %}
                                    <tr><td  class="cubg3 common_td"><span class="in_val">{{booked_count|either:0}}</span><div class="arrow-down"></div></td><td class="cubg4"><input type="text" name="{{key_subs}}" value='{{av_count}}'  class="css3 common_td" onclick="mytooltip('.third1_{{forloop.counter}}', {{team_count}});" /><div class="arrow-down"></div></td></tr>
                                    {% endwith %}
                                    {% endwith %}
                                    {% endwith %}
                                </table>
                            </td>
                            {% endwith %}
                        </tr>
                    {% endfor %}
                    <!-- End of next rows -->
                </table>
            </div>
        </form>
    {% endif %}
    </div>
</section>
<div id='hideteam'>
<select id='team' multiple='multiple' style='display:none;'>
{% for team in teams %}
    <option value='{{team.id}}' name='team'>{{team}}</option>
{% endfor %}
</select>
</div>
{% endblock content %}

{% block main_js %}
<script src="{% static 'js/jquery.classyloader.js' %}"></script>
<script type="text/javascript">
$('.arrow-down').css('display','none');
    // Show Error msg if no items are selected.
    function validateForm(){

        $('.drpDown .process-ul, .teams-ul').hide();

        // Check for process items, select-all, teams.
        if(!($('#selectedProcessType').children().length) || (!($('#selectedTeams option[value="000"]:only-child').length) && !$('#selectedTeams').children().length)){
            alert('Please select atleast one Process and Team value');
            return false;
        }

        return true;
    }

    //Clicking outside process type list hide teams list. 
    $('body').click(function(evt){
       if(evt.target.classList.contains('small') || evt.target.id == 'processTypeBtn'){
            $('.process-ul').show();
            if($('#selectedProcessType').val() == null){
                $('.teams-ul').hide();
              }else{
                $('.teams-ul').show();
              }
       }else{
            $('.process-ul, .teams-ul').hide();
       }
    });

    // Process Select Button - show Process list.
    $('#processTypeBtn').on('click', function(){
        $('.drpDown .process-ul, .teams-ul').toggle();
    });

    // Call Process Select.
    $('.process-ul').children().on('click', function(){
        selectProcessPopulateTeamData(this);
    });

    // Call Team Select.
    $('.teams-ul').children().on('click', function(){
        selectTeams(this.className, this);
    });

    // Select All Button. 
    $('#selectAll').on('click', function(){

        // UnSelect all.
        if($(this).hasClass('all-selected')){
            $(this).parent().children(':not(.hideItems)').children("a").children("span").removeClass('tickMarkShow');
            $(this).parent().children(':not(.hideItems)').each(function(){
                $('#selectedTeams').children("option[value='"+ $(this).attr('idValue')+"']").remove();
            });
            $(this).removeClass('all-selected');
            return;
        }

        // Select all.
        $(this).parent().children(':not(.hideItems)').children("a").children("span").addClass('tickMarkShow');
        $(this).parent().children(':not(.hideItems)').each(function(){
            var optionElement = "<option class ='"+$(this).attr('class')+"' value='"+ $(this).attr('idValue')+"' selected></option>";

            // Append to list if Element is not present.
            if(!$('#selectedTeams').has("option[value='"+$(this).attr('idValue')+"']").length){
                $('#selectedTeams').append(optionElement);
            }
        });
        $(this).addClass('all-selected');

    });

    function selectProcessPopulateTeamData(processElement){

        var processOptionElement = "<option value='"+$(processElement).attr('id')+"' selected></option>";
        var selectedProcessElement = $(processElement).children("a").children('span');

        // UnSelect Process Items.
        if(selectedProcessElement.hasClass('tickMarkShow')){
            selectedProcessElement.removeClass('tickMarkShow');     // UnSelect the Process Element.
            $('.'+$(processElement).attr('id')).children("a").children('span').removeClass('tickMarkShow'); // UnSelect the Process Element's teams.
            $('#selectedTeams').children("option[class='"+$(processElement).attr('id')+"']").remove();
            $('.'+$(processElement).attr('id')).addClass('hideItems');

            $('#selectAll').children("a").children('span').removeClass('tickMarkShow');;
            $('#selectedProcessType').children("option[value='"+$(processElement).attr('id')+"']").remove();

            // If the selectedTeams list has only selectAll option element then remove 'all-selected' from it.
            if($('#selectedTeams option[value="000"]:only-child').length){
                $('#selectAll').removeClass('all-selected');
            }

            // If selectAll element has Not got the class 'all-selected', then hide it.
            if(!$('#selectAll').hasClass('all-selected') && !$('#selectedProcessType').children().length){
                $('#selectAll').addClass('hideItems');
            }

        }

        // Select Process Items.
        else{
            $('.'+$(processElement).attr('id') + ', #selectAll').removeClass('hideItems');
            selectedProcessElement.addClass('tickMarkShow');
            $('#selectedProcessType').append(processOptionElement);

            // Remove select all tick.
            $('#selectAll').children("a").children("span").removeClass('tickMarkShow');
        }

    }

    function selectTeams(parentElementId, selectedElement){
        var selectedTeamsElement = $(selectedElement).children("a").children('span');
        var optionElement = "<option class ='"+parentElementId+"' value='"+ $(selectedElement).attr('idValue')+"' selected></option>";
        if(selectedTeamsElement.hasClass('tickMarkShow')){
            selectedTeamsElement.removeClass('tickMarkShow');
            $('#selectedTeams').children("option[value='"+ $(selectedElement).attr('idValue')+"']").remove();
            $('#selectAll').children("a").children("span").removeClass('tickMarkShow');
        }
        else{
            selectedTeamsElement.addClass('tickMarkShow');

            // Append to list if Element is not present.
            if(!$('#selectedTeams').has("option[value='"+$(selectedElement).attr('idValue')+"']").length){
                $('#selectedTeams').append(optionElement);
            }
        }
    }

    $(document).ready(function(){
        
       $('[rel=tooltip]').tooltip({container: 'body'});
       $('[data-toggle="tooltip"]').tooltip(); 
        var post_result_dict = {{post_result_dict|safe}};
        for(team in post_result_dict){
            selectProcessPopulateTeamData('#'+team);
            var teams = post_result_dict[team];
            for (item in teams){
                selectTeams(team, '#'+team+'_'+teams[item]);
                $('.'+team).removeClass('hideItems');
            }
        }
        // Click on Schedule button
        // Validate the slots entry
        $('.logbtn').click(function(){
            var isError = false;
            $('table tr td input[type=text]:enabled').each(function(){
                if(isNaN($(this).val())){
                    $(this).focus();
                    isError = true;
                    alert('Please enter a valid entry for available slots');
                    return false;
                }else if(parseInt($(this).val()) > 1000000 ){
                    $(this).focus();
                    isError = true;
                    alert('Available slots are out of range');
                    return false;
               }
            });
            if(isError){
                return false;
            }
        });

    });

    $("input[type=text]").bind("keypress", function(e) {
        // body...
        var key = e.keyCode ? e.keyCode : e.which;
        if ( isNaN( String.fromCharCode(key) ) ) return false;
    });


</script>
<script type="text/javascript">
    $('#prev_week').on('click', function(){
        processes = $('#selectedProcessType').val();
        teams = $('#selectedTeams').val();
        $('#prevselectedProcessType').val(processes);
        $('#prevselectedTeams').val(teams);
    });
    $('#next_week').on('click', function(){
        processes = $('#selectedProcessType').val();
        teams = $('#selectedTeams').val();
        $('#nextselectedProcessType').val(processes);
        $('#nextselectedTeams').val(teams);
    });

</script>
<script>
    function mytooltip(value1, value2){
        var html_rows = '';
        var html_data = '';
        var count = 0;
        var val_obj = value2;
        for(var i in val_obj){
            if (val_obj.hasOwnProperty(i)) {
                count++;
            }
        }
        if (count != 0){

        $('.new_row_display').remove();
            html_rows = "<tr class='new_row_display'><td class='display_count' colspan='100%' style='background:#E40404;padding-bottom: 0px !important;padding-top: 0px !important;'><div class='col-xs-12' style='padding-bottom: 0px !important;padding-top:0px !important;width: 102%;'><div class='col-xs-12' style='padding:0px;'><i class='fa fa-times vva'></i></div>"
        for(key in val_obj){
            html_data +=  "<div class='col-xs-12 col-sm-4 m_inner_div'>"+key+" ("+val_obj[key]+")</div>"
        }
        html_rows += html_data;
        html_rows += "</div></td></tr>"

        $(value1).closest('tr').after(html_rows);
        }else{
            $('.new_row_display').hide();
            $('.arrow-down').css('display','none');
            //no need to disply anything
        }
        if(value2 == 0){
            $('.new_row_display').hide();
            $('.arrow-down').css('display','none');
        }else if(count != 0){
            $('.new_row_display').show();
        }else{
            $('.new_row_display').hide();
        }
    }
    function mytooltip2(value1){
    $('.new_row_display').remove();
    }

    $(document).on('click','.vva', function(){
        $('.new_row_display').remove();
    });


    $(document).on('click', '.cubg4  input', function(){
        if($(this).val()==0){
            $('.arrow-down').css('display','none');
        }
        else{
        $('.arrow-down').css('display','none');
        $('.display_count').css('background','#EEEEEE');
        $(this).parent().find('.arrow-down').css('display','block');
        $('.arrow-down').css('border-bottom','10px solid #EEEEEE');
    }
    });

    $(document).on('click', '.cubg3', function(){
        if($(this).text()==0){
            $('.arrow-down').css('display','none');
        }
        else{
        $('.arrow-down').css('display','none');
        $('.display_count').css('background','#C7F4D3');
        $(this).find('.arrow-down').css('display','block');
        $('.arrow-down').css('border-bottom','10px solid #C7F4D3');
    }
    });

    $(document).on('click', '.vva', function(){
         $('.arrow-down').css('display','none');
    })

    function teamCount(team){
        if(team == 0)
        {
            $(".new_row_display_total").hide();
        }
        else{ 
            var s = [];
            $(".new_row_display_total").show();
            for(var k in team){
                s+= "<span class='col-lg-3 col-md-3 col-xs-3' style='background: #fff; padding: 5px 15px;margin:5px 35px;border-bottom: 1px solid #ccc;'>"+k+" ("+team[k]+")</span>";
            }
            $('#text-adding').html(s);
        }
    }

$("#click-close").click(function(){
         if ($('.new_row_display_total').is(":visible")) {
            $(".new_row_display_total").hide();
        }
    });


    </script>
{% endblock main_js %}