<script type="text/javascript">
    $(document).ready(function(){
        $('#tag_datepick, #setup_datepick').on('focus', function(){
            if ($('#tzone').val() == 0 || $('#tzone').val() == '0' || $('#tzone').val() == "") {
                alert("Please Select Advertiser Time Zone.");
                $('#tzone').focus();
                return false;
            }
            var process_type = $(this).attr('process_type');
            window.source_ele = $(this);
            $.colorbox({
                iframe:true,
                width:"60%",
                height:"510px",
                open:true,
                href: function(){
                    var datepick_val = window.source_ele.val();
                    if(!datepick_val){
                        var url = "{% url 'representatives.views.availability_list' %}" + '0-0-0/' + process_type + '/' + $('#country option:selected').attr('location_id') + '/'+ $('#tzone').val() + '/';
                    }else{
                        var selected_date = datepick_val.split(' ')
                        selected_date = selected_date[0].replace(/\//g, '-')
                        var url = "{% url 'representatives.views.availability_list' %}" + selected_date + '/' + process_type + '/' + $('#country option:selected').attr('location_id') + '/'+ $('#tzone').val() + '/';
                    }
                    return url;
                }
            });
        });

        $(document).bind('cbox_open', function() {
            $('html').css({
                overflow: 'hidden'
            });
        }).bind('cbox_closed', function() {
            $('html').css({
                overflow: 'auto'
            });
        });
    });
    
    $('input[name=tag_datepick_nApplicable]').click(function(){
        $('#tag_datepick').val('');
    });

    $('input[name=setup_datepick_nApplicable]').click(function(){
        $('#setup_datepick').val('');
    });

    $('input[name=migration_datepick_nApplicable]').click(function(){
        $('#migration_datepick').val('');
    });

    function checkURL(domain){
        domain = domain.replace('http://','');
        domain = domain.replace('https://','');
        var re = new RegExp(/^((?:(?:(?:\w[\.\-\+]?)*)\w)+)((?:(?:(?:\w[\.\-\+]?){0,62})\w)+)\.(\w{2,6})$/);
        return domain.match(re);
    }
    
    function changetime(abt) {
        var locations = {{time_zone_for_region|safe}}
        
        if (abt.value == 'UK'){
            $('#campid').val("701d0000000EaB7");
        }else if(abt.value == 'Ireland'){
            $('#campid').val("701d0000000EaP4");
        }else if(abt.value == 'US'){
            $('#campid').val("701d0000000EaB2");
        }else{
            $('#campid').val("None");
        }

        $('#tzone').html('');
        if(locations[abt.value].length == 1){
            var tz_info = locations[abt.value];
            var option = "<option value='" + tz_info[0]['zone_name'] + "'>"+ tz_info[0]['zone_name'] +"(UTC"+tz_info[0]['time_value']+")</option>"
            $('#tzone').html(option);
        }else{
            var option = "<option value='0'>--Select--</option>"
            var tz_info = locations[abt.value];
            for(var i=0;i<locations[abt.value].length;i++){
                option += "<option value='" + tz_info[i]['zone_name'] + "'>"+ tz_info[i]['zone_name'] +"(UTC"+tz_info[i]['time_value']+")</option>"
            }
            $('#tzone').html(option);
        }
    }

    function check_and_create_appointment(slots){
        var status = true;
        $.ajax({
            'type': 'POST',
            'async': false,
            'dataType': 'json',
            'url': "{% url 'representatives.views.check_and_add_appointment' %}",
            'data':{
                'time_zone': $('#tzone').val(),
                'slots': JSON.stringify(slots),
                'location_id': $('#country option:selected').attr('location_id')
            },
            'success': function(response){
                if(response['status'] == 'FAILED'){
                    alert('Oops! the slot for ' + response['type'] + ' has already been booked by someone else.\nPlease relaunch calendar app from the date picker and choose a different appointment');
                    status = false;
                }
            },
            'error':function(xhr, resp_status, error){
                alert('Something went wrong!. Please reload page')
                status = false;
            }
        })
        return status;  
    }
    $('#country, #tzone').change(function(){
        $('#tag_datepick, #setup_datepick').val('');
    });
</script>