{% extends 'layouts/main.html' %}

{% load staticfiles %}
{% load static %}
{% load question_list_tags %}

{% block title %}
  WPP Lead Status
{% endblock title %}

{% block main_css %}
    <style type="text/css">
    #ldap-user-info {
        margin-top: 0 !important;
        margin-bottom: 30px !important;
        text-align: center;
        }
    </style>
{% endblock main_css %}

{% block content %}


   <!-- content-region -->
  <section class="content-region">
    <div class="container-fluid">
      <h1>WPP Leads Summary</h1>
      <div class="row summary-container">
        <div class="col-xs-4 col-sm-4 col-md-2 placeholder">
          <div class="circle_red" id='open'>{{lead_status_dict.open }}</div>
          <div class="sum-lbl">Open</div>
        </div>

        <div class="col-xs-4 col-sm-4 col-md-2 placeholder">
          <div class="circle" id='in_ui_ux_review'>{{lead_status_dict.in_ui_ux_review}}</div>
          <div class="sum-lbl">In UI/UX Review</div>
        </div>

        <div class="col-xs-4 col-sm-4 col-md-2 placeholder">
          <div class="circle_orange" id='in_file_transfer'>{{lead_status_dict.in_file_transfer}}</div>
          <div class="sum-lbl">In File Transfer</div>
        </div>


        <div class="col-xs-4 col-sm-4 col-md-2 placeholder">
          <div class="circle_pur" id='on_hold'>{{lead_status_dict.on_hold}}</div>
          <div class="sum-lbl">On Hold</div>
        </div>
        <div class="col-xs-4 col-sm-4 col-md-2 placeholder">
          <div class="circle_yellow" id="in_mockup" >{{lead_status_dict.in_mockup}}</div>
          <div class="sum-lbl">In Mockup</div>
        </div>
        <div class="col-xs-4 col-sm-4 col-md-2 placeholder">
          <div class="circle_blue" id="mockup_review">{{lead_status_dict.mockup_review}}</div>
          <div class="sum-lbl">Mockup Review</div>
        </div>
        <div class="col-xs-4 col-sm-4 col-md-2 placeholder">
          <div class="circle_pink" id="deferred">{{lead_status_dict.deferred}}</div>
          <div class="sum-lbl">Deferred</div>
        </div>
        <div class="col-xs-4 col-sm-4 col-md-2 placeholder">
          <div class="circle_lgreen" id="in_development">{{lead_status_dict.in_development}}</div>
          <div class="sum-lbl">In Development</div>
        </div>
        <div class="col-xs-4 col-sm-4 col-md-2 placeholder">
          <div class="circle_green" id="in_stage">{{lead_status_dict.in_stage}}</div>
          <div class="sum-lbl">In Stage</div>
        </div>
        <div class="col-xs-4 col-sm-4 col-md-2 placeholder">
          <div class="circle_purple" id="implemented">{{lead_status_dict.implemented}}</div>
          <div class="sum-lbl">Implemented</div>
        </div>
        <div class="col-xs-4 col-sm-4 col-md-2 placeholder">
          <div class="circle_black" id="total_leads">{{lead_status_dict.total_leads}}</div>
          <div class="sum-lbl">Total</div>
        </div>
      </div>
      <h1 class="lead_status">WPP Leads Status</h1>
      <div class="row">
          <div class="col-xs-10 col-sm-12 col-md-10">
            <ul class="pagination pull-left">
              <li><a class="tag" href="javascript:void(0);" id='all'>All</a></li>
              <li><a class="page" href="javascript:void(0);" id='Open'>Open</a></li>
              <li><a class="page" href="javascript:void(0);" id='InUIUXReview'>In UI/UX Review</a></li>
              <li><a class="page" href="javascript:void(0);" id='InFileTransfer'>In File Transfer</a></li>
              <li><a class="page" href="javascript:void(0);" id='OnHold'>On Hold</a></li>
              <li><a class="page" href="javascript:void(0);" id='InMockup'>In Mockup</a></li>
              <li><a class="page" href="javascript:void(0);" id='MockupReview' >Mockup Review</a></li>
              <li><a class="page" href="javascript:void(0);" id='Deferred'>Deferred</a></li>
              <li><a class="page" href="javascript:void(0);" id='MockupDelivered'>Mockup Delivered</a></li>
              <li><a class="page" href="javascript:void(0);" id='InDevelopment'>In Development</a></li>
              <li><a class="page" href="javascript:void(0);" id='InStage'>In Stage</a></li>
              <li><a class="page" href="javascript:void(0);" id='Implemented'>Implemented</a></li>
            </ul>
            <div class="table-search">
              <input type="text" class="form-control input-sm" id="inputValidation" placeholder="Filter by text" onkeyup="filter(this, 'Leads')"/>
              <span class="search-icon"><i class="fa fa-search" style="margin-top:12px;"/></i></span>
            </div>
            
          </div>
          <div class="col-xs-2 col-md-2">            
              <ul class="filter-area navbar-right">
                <li class="lbl">Sort by: </li>
                <li class="dropdown"><a href="javascript:void(0);" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><span id='sortBy'>Recent</span> <i class="fa fa-angle-down"></i></a>
                  <ul class="dropdown-menu light" role="menu">
                    <li><a href="javascript:void(0);" id="RecentHeader">Recent</a></li>
                    <li><a href="javascript:void(0);" id="statusHeader">Status</a></li>
                  </ul>
                  </li>
              </ul>
            </div>
          </div>
        <div class="table-container">
          <table class="table status-table tablesorter" id='Leads'>
            <thead>
                <tr class="table_bg">
                  <th class="hidden-xs hidden-sm nthchild">No.</th>
                  <th class="hidden-xs hidden-sm nthchild1">Website</th>
                  <th width="20%" class="nthchild2">CID </th>
                  <th class="hidden-xs hidden-sm nthchild3">Google Rep</th>
                  <th class="hidden-xs hidden-sm nthchild3">Regalix Rep</th>
                  <th class="hidden-xs hidden-sm nthchild3" id="RecentRow">Date Created</th>
                  <th class="hidden-xs hidden-sm nthchild3">Appointment Time</th>
                  <!-- <th class="hidden-xs hidden-sm nthchild3">Date of Installation</th> -->
                  <!-- <th class="hidden-xs hidden-sm nthchild8">Google Comments</th> -->
                  <th class="hidden-xs hidden-sm nthchild8">Regalix Comments</th>
                  <th class="nthchild3" id='StatusRow'>Status </th>
                </tr>
            </thead>
            <tbody id="tableBody">
                  {% for l in leads %}

                      {% if l.lead_status == 'Open' %}
                      <tr class='status-open open searchable'>
                        <td class="hidden-xs hidden-sm"><span class="status-bor-color">{{forloop.counter}}</span></td>
                        {% elif l.lead_status == 'In UI/UX Review' %}
                      <tr class='status-inuiuxreview inuiuxreview searchable'>
                        <td class="hidden-xs hidden-sm"><span class="status-bor-color">{{forloop.counter}}</span></td>
                        {% elif l.lead_status == 'In File Transfer' %}
                      <tr class='status-infiletransfer infiletransfer searchable'>
                        <td class="hidden-xs hidden-sm"><span class="status-bor-color">{{forloop.counter}}</span></td>
                      {% elif l.lead_status == 'On Hold' %}
                      <tr class='status-onhold onhold searchable'>
                        <td class="hidden-xs hidden-sm"><span class="status-bor-color">{{forloop.counter}}</span></td>
                      {% elif l.lead_status == 'In Mockup' %}
                      <tr class="status-inmockup  inmockup searchable">
                        <td class="hidden-xs hidden-sm"><span class="status-bor-color">{{forloop.counter}}</span></td>
                      {% elif l.lead_status == 'Mockup Review' %}
                      <tr class='status-mockupreview mockupreview searchable'>
                        <td class="hidden-xs hidden-sm"><span class="status-bor-color">{{forloop.counter}}</span></td>
                      {% elif l.lead_status == 'Deferred' %}
                      <tr class='status-deferred deferred searchable'>
                        <td class="hidden-xs hidden-sm"><span class="status-bor-color">{{forloop.counter}}</span></td>
                        {% elif l.lead_status == 'Mockup Delivered' %}
                      <tr class='status-mockupdelivered mockupdelivered searchable'>
                        <td class="hidden-xs hidden-sm"><span class="status-bor-color">{{forloop.counter}}</span></td>
                        {% elif l.lead_status == 'In Development' %}
                      <tr class='status-indevelopment indevelopment searchable'>
                        <td class="hidden-xs hidden-sm"><span class="status-bor-color">{{forloop.counter}}</span></td>
                        {% elif l.lead_status == 'In Stage' %}
                          <tr class='status-instage instage searchable'>
                            <td class="hidden-xs hidden-sm"><span class="status-bor-color">{{forloop.counter}}</span></td>
                      {% else %}
                        <tr class='status-implemented implemented searchable'>
                        <td class="hidden-xs hidden-sm"><span class="status-bor-color">{{forloop.counter}}</span></td>
                      {% endif %}
                      <td class="hidden-xs hidden-sm">{{ l.url_1 }}</td>
                      <td>{{ l.customer_id }}</td>
                      <td class="hidden-xs hidden-sm">{{ l.google_rep_name }}</td>
                      <td class="hidden-xs hidden-sm">{{ l.lead_owner_name }}</td>
                      <td class="hidden-xs hidden-sm">{{ l.created_date |date:"m/d/Y" }}</td>
                      <td class="hidden-xs hidden-sm">{{ l.appointment_date |date:"m/d/Y [h:i] A" }}</td>
                      <!-- <td class="hidden-xs hidden-sm">{{ l.date_of_installation |date:"m/d/Y" }}</td> -->
                      
                      {% if l.regalix_comment  %}
                          <td class="hidden-xs hidden-sm comments-container comments-container2">
                          <p>
                          {% if l.regalix_comment != 'None' %}
                            {{ l.regalix_comment | truncatechars:100 }}
                          {% endif %}
                          </p>
                            <p class="comments-full"><img class="left-arrow" src="{%static 'images/comments-left-arrow.png' %}"> {% if l.regalix_comment != 'None' %} {{ l.regalix_comment}} {% endif %}</p> </td>
                      {% else %}
                          <td class="hidden-xs hidden-sm comments-container"><p></p>
                            </td>
                      {% endif %}
                     
                        <td><span class="status-txt-color">{{ l.lead_status }}</span></td>
                    </tr>
                    
                {% endfor %}
          </tbody>
        </table>
        <!-- <img src="{%static 'images/pre_loading.png' %}" alt=" " class="pre-load-img"/> -->
        </div>
    </div>
  </section>
  <!-- content-region ends --> 

{% endblock content %}
{% block main_js %}

<script src="{% static 'js/jquery-ui.js' %}"></script>
<script src="{% static 'js/wpp_lead_summary.js' %}"></script>

<script type="text/javascript">

$(document).ready(function(){
  window.lead_status = {{lead_status_dict|safe}}
  window.leads = {{leads|safe}}
  setWppLeadSummary(window.lead_status)
  setWppLeadSummaryTable(window.leads)
});

function setWppLeadSummary(lead_status){
    $('#open').text(lead_status['open'])
    $('#in_ui_ux_review').text(lead_status['in_ui_ux_review'])
    $('#in_file_transfer').text(lead_status['in_file_transfer'])
    $('#on_hold').text(lead_status['on_hold'])
    $('#in_mockup').text(lead_status['in_mockup'])
    $('#mockup_review').text(lead_status['mockup_review'])
    $('#deferred').text(lead_status['deferred'])
    $('#in_development').text(lead_status['in_development'])
    $('#in_stage').text(lead_status['in_stage'])
    $('#implemented').text(lead_status['implemented'])
    $('#total_leads').text(lead_status['total_leads'])
    
  }
  function setWppLeadSummaryTable(leads){

    $('#tableBody').html('')
    for(i=0; i<leads.length; i += 1){
        c = i + 1
        if(leads[i].lead_status == 'Open' ){
          counter = '<tr class="status-open open searchable">'+'<td class="hidden-xs hidden-sm"><span class="status-bor-color">' +  c + '</span></td>'
       }

       else if (leads[i].lead_status == 'In UI/UX Review'){
         counter =  '<tr class="status-inuiuxreview inuiuxreview searchable">' + '<td class="hidden-xs hidden-sm"><span class="status-bor-color">'+  c + '</span></td>'
        }

        else if (leads[i].lead_status == 'In File Transfer'){
         counter =  '<tr class="status-infiletransfer infiletransfer searchable">' + '<td class="hidden-xs hidden-sm"><span class="status-bor-color">'+  c + '</span></td>'
        }

       else if (leads[i].lead_status == 'On Hold'){
         counter =  '<tr class="status-onhold onhold searchable">' + '<td class="hidden-xs hidden-sm"><span class="status-bor-color">'+  c + '</span></td>'
        }else if (leads[i].lead_status == 'In mockup'){
        counter = '<tr class="status-inmockup  inmockup searchable">' + '<td class="hidden-xs hidden-sm"><span class="status-bor-color">'+  c + '</span></td>'
        }else if (leads[i].lead_status == 'Mockup Review') {
        counter = '<tr class="status-mockupreview mockupreview searchable">'+'<td class="hidden-xs hidden-sm"><span class="status-bor-color">'+  c + '</span></td>'
        }else if (leads[i].lead_status == 'Deferred') {
        counter = '<tr class="status-deferred deferred searchable">'+' <td class="hidden-xs hidden-sm"><span class="status-bor-color">' +  c + '</span></td>'
        }
        else if (leads[i].lead_status == 'In Development') {
        counter = '<tr class="status-indevelopment indevelopment searchable">'+' <td class="hidden-xs hidden-sm"><span class="status-bor-color">' +  c + '</span></td>'
        }else if(leads[i].lead_status == 'In Stage'){
          counter = '<tr class="status-instage instage searchable">'+'<td class="hidden-xs hidden-sm"><span class="status-bor-color">' + c +'</span></td>' 
        }else{
          counter = '<tr class="status-launched launched searchable">'+'<td class="hidden-xs hidden-sm"><span class="status-bor-color">' + c +'</span></td>' 
        }

       other =  '<td class="hidden-xs hidden-sm">' + leads[i].url + '</td>' +
                '<td>' + leads[i].cid + '</td>'+
                '<td class="hidden-xs hidden-sm">' + leads[i].google_rep + '</td>'+
                '<td class="hidden-xs hidden-sm">' + leads[i].regalix_rep + '</td>'+
                '<td class="hidden-xs hidden-sm">' + leads[i].date_created + '</td>'+
                '<td class="hidden-xs hidden-sm">' + leads[i].appointment_time + '</td>'
                
    
      commnet = '<td class="hidden-xs hidden-sm comments-container comments-container2"><p>' + leads[i].regalix_comment.substring(1, 100) + '</p>' +
                '<p class="comments-full"><img class="left-arrow" src="/static/images/comments-left-arrow.png">' + leads[i].regalix_comment + '</p> </td>'
        
      status = '<td><span class="status-txt-color">'+ leads[i].lead_status +'</span></td>'
      $('#tableBody').append(counter+other+commnet+status)
      
    }
  }


$('#ldap').keypress(function (e) {
 var key = e.which;
 if(key == 13)  // the enter key code
  {
    $( "#getLead" ).trigger( "click" );
  }
});

</script>
{% endblock main_js %}
