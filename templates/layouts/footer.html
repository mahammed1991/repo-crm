{% load static %}
<a href="#" class="report-a-bug" title="Report a Bug" data-toggle="modal" data-target="#feedbackModal" onclick='hideOlark();' data-backdrop="static" data-keyboard="false"></a>
<footer class="footer">
    <div class="container-fluid">
        <ul>
            <li>Â© 2016 Regalix Inc.</li>
            <li><a href="#">Terms of Use</a></li>
            <li><a href="#">Privacy Policy</a></li>
        </ul>
    </div>
</footer>

<!-- feedback modal -->
        <div class="modal" id="feedbackModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
          <div class="modal-dialog ping-snippet">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close close-modal" data-dismiss="modal" aria-label="Close" onclick="showOlark()"><i aria-hidden="true" class="fa fa-times-circle"></i></button>
                <h4 class="modal-title" id="myModalLabel">Report a Bug</h4>
              </div>
              <div class="modal-body" id="feedback-body">
                <form method='POST' enctype="multipart/form-data" id="portalFeedback">
                    {% csrf_token %}
                   <input type="text" class="form-control" style="padding: 0px 10px;" id="ldap" value='{{request.user.first_name}} {{request.user.last_name}}' disabled />
                     <select class="form-control" id="feedbackType" name="type">
                        <option value="Feedback Type">Bug Found</option>
                        <option value="UI / Design Related"> UI / Design Related</option>
                        <option value="not_able_to_submit_lead"> Not able to submit lead</option>
                        <option value="UX / Experience Related">UX / Experience Related</option>
                        <option value="Incorrect Data / Information">Incorrect Data / Information</option>
                    </select>
                   <div id="preloaderOverlay" class="footeroverlay" style='display:none;margin-left: -16px;'>
                      <div class="preloader">
                      <img src="{% static 'images/preloader.gif'%}" width="40" height="40" >
                      </div>
                    </div>
                    <textarea class="form-control" placeholder="Comments" id='comments' name="comment"></textarea>
                    
                      <!--<input type='file' name="attachmentfile" style="width:200px" id="attachmentfile" /> 
                      <div style="padding-left: 21%;">
                        <input type="file" id="attachmentfile" style="display:none" name="attachmentfile">
                        <a href="#"><img src="{% static 'images/browse.png' %}" w id="img1" style="padding-left: 9%;width: 65%;margin: auto;" /></a>
                      </div>
                      -->
                      <div style="width:100%;">  
                      <input type="button" value="Choose file" id="fakeBrowse" onclick="HandleBrowseClick();" style="width:40%;"/> 
                      <input type="file" id="attachmentfile" name="attachmentfile" style="display: none" onChange="Handlechange();" />
                      <input type="text" id="filename" readonly="true" style="width:58%;" />
                      

                      </div>                     
                                          
                    <!-- <i class="fa fa-paperclip" name="attachmentfile"></i> -->
                </div>
                <div class="modal-footer" style="text-align:center;">

                  <div class="btn-group">
                      <button class="btn std-btn" id='SubmitFeedback' style="border-radius:2px;">Submit</button>
                  </div>
                </div>
               </form>
            </div>
          </div>
        </div>
        <!-- feedback modal ends -->

{% block main_js %}
<script src="{% static 'js/jquery-1.11.1.min.js' %}"></script>
<script src="{% static 'js/bootstrap.min.js' %}"></script> 
<script type="text/javascript">
function showOlark(){
  olark('api.box.show');
}
	function hideOlark(){
	  olark('api.box.hide');
	}
  function HandleBrowseClick()
{
    var fileinput = document.getElementById("attachmentfile");
    fileinput.click();
}

function Handlechange()
{
    var fileinput = document.getElementById("attachmentfile");
    var textinput = document.getElementById("filename");
    textinput.value = fileinput.value;
}


$('#portalFeedback').submit(function(event){
  event.preventDefault();
  $(".error-box").removeClass('error-box');
    var feedbackType = $('#feedbackType').val();
    var comments = $('#comments').val();
   if(feedbackType === 'Feedback Type'){
      $('#feedbackType').addClass('error-box');
      return false;
    }else if(comments === ''){
      $('#comments').addClass('error-box');
      return false;
    }else{
      var formData = new FormData($('#portalFeedback')[0]);
        $('.footeroverlay').show();
        $.ajax({
            url: '/main/report-a-bug/',
            type: 'POST',
            data: formData,
            cache: false,
            contentType: false,
            processData: false,
            success: function (data) {
                $('.footeroverlay').hide();
                $('.close-modal').trigger('click');
                $("#feedbackType").val("Feedback Type");
                $("#comments").val("");
                $("#attachmentfile").val("");
                $("#filename").val("");
                showOlark();
            },
            error: function (error) {
                $('.footeroverlay').hide();
                console.log(error);
            }
        });

    }
    return false;
});
 </script>
{% endblock main_js%}